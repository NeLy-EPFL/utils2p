
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Loading and saving &#8212; utils2p  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <link rel="stylesheet" href="_static/css/functions.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/methods.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/classes.css" type="text/css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Miscellaneous" href="misc_main.html" />
    <link rel="prev" title="File discovery" href="file_discovery.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="loading-and-saving">
<h1>Loading and saving<a class="headerlink" href="#loading-and-saving" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="utils2p.save_img">
<span class="sig-prename descclassname"><span class="pre">utils2p.</span></span><span class="sig-name descname"><span class="pre">save_img</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imagej</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">color</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">full_dynamic_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils2p/main.html#save_img"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils2p.save_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves an image that is given as a numpy array to file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>string</em>) – Path where the file is saved.</p></li>
<li><p><strong>img</strong> (<em>numpy array</em>) – Image or stack. For stacks, the first dimension is the stack index.
For color images, the last dimension are the RGB channels.</p></li>
<li><p><strong>imagej</strong> (<em>boolean</em>) – Save imagej compatible stacks and hyperstacks.</p></li>
<li><p><strong>color</strong> (<em>boolean</em><em>, </em><em>default = False</em>) – Determines if image is RGB or gray scale.
Will be converted to uint8.</p></li>
<li><p><strong>full_dynamic_range</strong> (<em>boolean</em><em>, </em><em>default = True</em>) – When an image is converted to uint8 for saving a color image the
max value of the output image is the max of uint8,
i.e. the image uses the full dynamic range available.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils2p.load_img">
<span class="sig-prename descclassname"><span class="pre">utils2p.</span></span><span class="sig-name descname"><span class="pre">load_img</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">memmap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils2p/main.html#load_img"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils2p.load_img" title="Permalink to this definition">¶</a></dt>
<dd><p>This functions loads an image from file and returns as a numpy array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>string</em>) – Path to image file.</p></li>
<li><p><strong>memmap</strong> (<em>bool</em>) – If <cite>True</cite>, the image is not loaded into memory but remains on
disk and a <cite>numpy.memmap</cite> object is returned. It can be indexed
like a normal <cite>numpy.array</cite>. This option is useful when a stack
does not fit into memory. It can also be used when opening many
stacks simultaneously.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Image in form of numpy array or numpy memmap.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.array or numpy.memmap</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils2p</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">load_img</span><span class="p">(</span><span class="s2">&quot;data/chessboard_GRAY_U16.tif&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="go">&lt;class &#39;numpy.ndarray&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(200, 200)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">load_img</span><span class="p">(</span><span class="s2">&quot;data/chessboard_GRAY_U16.tif&quot;</span><span class="p">,</span> <span class="n">memmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="go">&lt;class &#39;numpy.memmap&#39;&gt;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils2p.load_raw">
<span class="sig-prename descclassname"><span class="pre">utils2p.</span></span><span class="sig-name descname"><span class="pre">load_raw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils2p/main.html#load_raw"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils2p.load_raw" title="Permalink to this definition">¶</a></dt>
<dd><p>This function loads a raw image generated by ThorImage as a numpy array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>string</em>) – Path to raw file.</p></li>
<li><p><strong>metadata</strong> (<em>ElementTree root</em>) – Can be obtained with <code class="xref py py-func docutils literal notranslate"><span class="pre">get_metadata()</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>stacks</strong> – Number of numpy arrays depends on the number of channels recoded during
the experiment. Has the following dimensions:
TZYX or TYX for planar images.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tuple of numpy arrays</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils2p</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">Metadata</span><span class="p">(</span><span class="s1">&#39;data/mouse_kidney_raw/2p/Untitled_001/Experiment.xml&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stack1</span><span class="p">,</span> <span class="n">stack2</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">load_raw</span><span class="p">(</span><span class="s1">&#39;data/mouse_kidney_raw/2p/Untitled_001/Image_0001_0001.raw&#39;</span><span class="p">,</span><span class="n">metadata</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">stack1</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">stack2</span><span class="p">)</span>
<span class="go">(&lt;class &#39;numpy.ndarray&#39;&gt;, &lt;class &#39;numpy.ndarray&#39;&gt;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">utils2p</span><span class="o">.</span><span class="n">save_img</span><span class="p">(</span><span class="s1">&#39;stack1.tif&#39;</span><span class="p">,</span><span class="n">stack1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">utils2p</span><span class="o">.</span><span class="n">save_img</span><span class="p">(</span><span class="s1">&#39;stack2.tif&#39;</span><span class="p">,</span><span class="n">stack2</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils2p.load_z_stack">
<span class="sig-prename descclassname"><span class="pre">utils2p.</span></span><span class="sig-name descname"><span class="pre">load_z_stack</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils2p/main.html#load_z_stack"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils2p.load_z_stack" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads tif files as saved when capturing a z-stack into a 3D numpy array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>string</em>) – Path to directory of the z-stack.</p></li>
<li><p><strong>metadata</strong> (<em>ElementTree root</em>) – Can be obtained with <code class="xref py py-func docutils literal notranslate"><span class="pre">get_metadata()</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>stacks</strong> – Z-stacks for Channel A (green) and Channel B (red).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tuple of numpy arrays</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils2p</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">Metadata</span><span class="p">(</span><span class="s2">&quot;data/mouse_kidney_z_stack/Experiment.xml&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z_stack_A</span><span class="p">,</span> <span class="n">z_stack_B</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">load_z_stack</span><span class="p">(</span><span class="s2">&quot;data/mouse_kidney_z_stack/&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">z_stack_A</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">z_stack_B</span><span class="p">)</span>
<span class="go">(&lt;class &#39;numpy.ndarray&#39;&gt;, &lt;class &#39;numpy.ndarray&#39;&gt;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z_stack_A</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">z_stack_B</span><span class="o">.</span><span class="n">shape</span>
<span class="go">((3, 128, 128), (3, 128, 128))</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils2p.load_optical_flow">
<span class="sig-prename descclassname"><span class="pre">utils2p.</span></span><span class="sig-name descname"><span class="pre">load_optical_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gain_0_x</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gain_0_y</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gain_1_x</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gain_1_y</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smoothing_kernel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils2p/main.html#load_optical_flow"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils2p.load_optical_flow" title="Permalink to this definition">¶</a></dt>
<dd><p>This function loads the optical flow data from
the file specified in path. By default it is
directly converted into ball rotation. Gain values
have to be determined with the calibration of the
optical flow sensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>str</em>) – Path to file holding the optical flow data.</p></li>
<li><p><strong>gain_0_x</strong> (<em>float</em>) – Gain for the x direction of sensor 0.</p></li>
<li><p><strong>gain_0_y</strong> (<em>float</em>) – Gain for the y direction of sensor 0.</p></li>
<li><p><strong>gain_1_x</strong> (<em>float</em>) – Gain for the x direction of sensor 1.</p></li>
<li><p><strong>gain_1_y</strong> (<em>float</em>) – Gain for the y direction of sensor 1.</p></li>
<li><p><strong>smoothing_kernel</strong> (<em>numpy array</em><em>, </em><em>optional</em>) – Default is None, in which case the sensor signals
are not smoothed. The signal is convolved with this
kernel. A reasonable choice seems to be a moving average
filter of length 300: np.ones(300) / 300.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>data</strong> – A dictionary with keys: ‘sensor0’, ‘sensor1’,
‘time_stamps’, ‘vel_pitch’, ‘vel_yaw’, ‘vel_roll’.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dictionary</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils2p</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gain_0_x</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">1.45</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gain_0_y</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">1.41</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gain_1_x</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">1.40</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gain_1_y</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">1.36</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">optical_flow_file</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">find_optical_flow_file</span><span class="p">(</span><span class="s2">&quot;data/mouse_kidney_raw&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">optical_flow</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">load_optical_flow</span><span class="p">(</span><span class="n">optical_flow_file</span><span class="p">,</span> <span class="n">gain_0_x</span><span class="p">,</span> <span class="n">gain_0_y</span><span class="p">,</span> <span class="n">gain_1_x</span><span class="p">,</span> <span class="n">gain_1_y</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">optical_flow</span><span class="p">)</span>
<span class="go">&lt;class &#39;dict&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">optical_flow</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">dict_keys([&#39;sensor0&#39;, &#39;sensor1&#39;, &#39;time_stamps&#39;, &#39;vel_pitch&#39;, &#39;vel_yaw&#39;, &#39;vel_roll&#39;])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">optical_flow</span><span class="p">[</span><span class="s2">&quot;time_stamps&quot;</span><span class="p">])</span>
<span class="go">&lt;class &#39;numpy.ndarray&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">optical_flow</span><span class="p">[</span><span class="s2">&quot;time_stamps&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(1408,)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">optical_flow</span><span class="p">[</span><span class="s2">&quot;vel_pitch&quot;</span><span class="p">])</span>
<span class="go">&lt;class &#39;numpy.ndarray&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">optical_flow</span><span class="p">[</span><span class="s2">&quot;vel_pitch&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(1408,)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">optical_flow</span><span class="p">[</span><span class="s2">&quot;vel_yaw&quot;</span><span class="p">])</span>
<span class="go">&lt;class &#39;numpy.ndarray&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">optical_flow</span><span class="p">[</span><span class="s2">&quot;vel_yaw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(1408,)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">optical_flow</span><span class="p">[</span><span class="s2">&quot;vel_roll&quot;</span><span class="p">])</span>
<span class="go">&lt;class &#39;numpy.ndarray&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">optical_flow</span><span class="p">[</span><span class="s2">&quot;vel_roll&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(1408,)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">optical_flow</span><span class="p">[</span><span class="s2">&quot;sensor0&quot;</span><span class="p">])</span>
<span class="go">&lt;class &#39;dict&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">optical_flow</span><span class="p">[</span><span class="s2">&quot;sensor0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">dict_keys([&#39;x&#39;, &#39;y&#39;, &#39;gain_x&#39;, &#39;gain_y&#39;])</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">optical_flow</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">load_optical_flow</span><span class="p">(</span><span class="n">optical_flow_file</span><span class="p">,</span> <span class="n">gain_0_x</span><span class="p">,</span> <span class="n">gain_0_y</span><span class="p">,</span> <span class="n">gain_1_x</span><span class="p">,</span> <span class="n">gain_1_y</span><span class="p">,</span> <span class="n">smoothing_kernel</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span> <span class="o">/</span> <span class="mi">300</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">optical_flow</span><span class="p">[</span><span class="s2">&quot;vel_pitch&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(1408,)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils2p.load_stack_batches">
<span class="sig-prename descclassname"><span class="pre">utils2p.</span></span><span class="sig-name descname"><span class="pre">load_stack_batches</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils2p/main.html#load_stack_batches"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils2p.load_stack_batches" title="Permalink to this definition">¶</a></dt>
<dd><p>This function loads a stack in several batches to make sure
the system does not run out of memory. It returns a generator
that yields consecutive chunks of <cite>batch_size</cite> frames of the stack.
The remaining memory is freed up by the function until the generator
is called again.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>string</em>) – Path to stack.</p></li>
<li><p><strong>batch_size</strong> (<em>int</em>) – Number of frames in one chunk.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Generator that yields chunks of <cite>batch_size</cite> frames of the
stack.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>generator</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils2p.load_stack_patches">
<span class="sig-prename descclassname"><span class="pre">utils2p.</span></span><span class="sig-name descname"><span class="pre">load_stack_patches</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patch_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">padding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_indices</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils2p/main.html#load_stack_patches"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils2p.load_stack_patches" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a generator that yields patches of the stack of images.
This is useful when multiple stacks should be processed but they
don’t fit into memory, e.g. when computing an overall fluorescence
baseline for all trials of a fly.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>string</em>) – Path to stack.</p></li>
<li><p><strong>patch_size</strong> (<em>tuple of two integers</em>) – Size of the patch returned.</p></li>
<li><p><strong>padding</strong> (<em>integer</em><em> or </em><em>tuple of two integers</em>) – The amount of overlap between patches. Note that this increases
the effective patch size. Default is 0. If tuple, different padding
is used for the dimensions.</p></li>
<li><p><strong>return_indices</strong> (<em>boolean</em>) – <p>If True, the indices necessary for slicing to generate the patch and
the indices necessary for slicing to remove the padding from the
returned patch are returned. Default is False.
The values are retuned in the following form:
<a href="#id1"><span class="problematic" id="id2">``</span></a>`
indices = [[start_patch_dim_0, stop_patch_dim_0],</p>
<blockquote>
<div><p>[start_patch_dim_1, stop_patch_dim_1],]</p>
</div></blockquote>
<dl class="simple">
<dt>patch_indices = [[start_after_padding_dim_0, stop_after_padding_dim_0],</dt><dd><p>[start_after_padding_dim_1, stop_after_padding_dim_1],]</p>
</dd>
</dl>
<p><a href="#id3"><span class="problematic" id="id4">``</span></a><a href="#id5"><span class="problematic" id="id6">`</span></a></p>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>patch</strong> (<em>numpy array</em>) – Patch of the stack.</p></li>
<li><p><strong>indices</strong> (<em>tuples of integers, optional</em>) – See description of the <cite>return_indices</cite> parameter above
and examples below.</p></li>
<li><p><strong>patch_indices</strong> (<em>tuples of integers, optinal</em>) – See description of the <cite>return_indices</cite> parameter above
and examples below.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils2p</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">Metadata</span><span class="p">(</span><span class="s1">&#39;data/mouse_kidney_raw/2p/Untitled_001/Experiment.xml&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stack1</span><span class="p">,</span> <span class="n">stack2</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">load_raw</span><span class="p">(</span><span class="s1">&#39;data/mouse_kidney_raw/2p/Untitled_001/Image_0001_0001.raw&#39;</span><span class="p">,</span><span class="n">metadata</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stack1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(5, 256, 256)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">utils2p</span><span class="o">.</span><span class="n">save_img</span><span class="p">(</span><span class="s1">&#39;stack1.tif&#39;</span><span class="p">,</span><span class="n">stack1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">generator</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">load_stack_patches</span><span class="p">(</span><span class="s1">&#39;stack1.tif&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">first_patch</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">first_patch</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(5, 5, 4)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">generator</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">load_stack_patches</span><span class="p">(</span><span class="s1">&#39;stack1.tif&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">return_indices</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">first_patch</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">patch_indices</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">first_patch</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(5, 18, 23)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">patch_indices</span><span class="p">)</span>
<span class="go">[[0, 15], [0, 20]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
<span class="go">[[0, 15], [0, 20]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">first_patch_without_padding</span> <span class="o">=</span> <span class="n">first_patch</span><span class="p">[:,</span> <span class="n">patch_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">patch_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">patch_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">patch_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">first_patch_without_padding</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(5, 15, 20)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">stack1</span><span class="p">[:,</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="n">first_patch_without_padding</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Note that the patch has no padding at the edges.
When looking at the second patch we see that it is padded on both side
in the second dimension but still only on one side of the first dimension.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">second_patch</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">patch_indices</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">second_patch</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(5, 18, 26)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">patch_indices</span><span class="p">)</span>
<span class="go">[[0, 15], [3, 23]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
<span class="go">[[0, 15], [20, 40]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">second_patch_without_padding</span> <span class="o">=</span> <span class="n">second_patch</span><span class="p">[:,</span> <span class="n">patch_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">patch_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">patch_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">patch_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">second_patch_without_padding</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(5, 15, 20)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils2p.load_fictrac">
<span class="sig-prename descclassname"><span class="pre">utils2p.</span></span><span class="sig-name descname"><span class="pre">load_fictrac</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ball_radius</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils2p/main.html#load_fictrac"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils2p.load_fictrac" title="Permalink to this definition">¶</a></dt>
<dd><p>This functions loads the fictrac data from file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>str</em>) – Path to fictrac output file (.dat).</p></li>
<li><p><strong>ball_radius</strong> (<em>int</em>) – Radius of the spherical treadmill.</p></li>
<li><p><strong>fps</strong> (<em>float</em>) – Number of frames per second.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>data</strong> – A dictionary with the following keys:
Speed, x, y, forward_pos, side_pos, delta_rot_lab_side,
delta_rot_lab_forward, delta_rot_lab_turn, integrated_forward_movement,
integrated_side_movement, Time
All speeds are in mm/s and all positions are in mm.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dictionary</p>
</dd>
</dl>
</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">utils2p</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="main.html">Core functions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="main.html#core-module">Core module</a></li>
<li class="toctree-l2"><a class="reference internal" href="metadata.html">Microscope metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="file_discovery.html">File discovery</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Loading and saving</a></li>
<li class="toctree-l2"><a class="reference internal" href="misc_main.html">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="synchronization.html">Synchronization functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="main.html">Core functions</a><ul>
      <li>Previous: <a href="file_discovery.html" title="previous chapter">File discovery</a></li>
      <li>Next: <a href="misc_main.html" title="next chapter">Miscellaneous</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Florian Aymanns.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/load_save.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>