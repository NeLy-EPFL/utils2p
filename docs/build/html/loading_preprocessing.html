
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Loading and preprocessing &#8212; utils2p  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <link rel="stylesheet" href="_static/css/functions.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/methods.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/classes.css" type="text/css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Conversion of synchronization" href="conversion.html" />
    <link rel="prev" title="Synchronization functions" href="synchronization.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="loading-and-preprocessing">
<h1>Loading and preprocessing<a class="headerlink" href="#loading-and-preprocessing" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="utils2p.synchronization.get_lines_from_sync_file">
<span class="sig-prename descclassname"><span class="pre">utils2p.synchronization.</span></span><span class="sig-name descname"><span class="pre">get_lines_from_sync_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line_names</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils2p/synchronization.html#get_lines_from_sync_file"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils2p.synchronization.get_lines_from_sync_file" title="Permalink to this definition">¶</a></dt>
<dd><p>This function returns the values of the requested lines save in
an h5 generated by ThorSync.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_path</strong> (<em>string</em>) – Path to h5 file.</p></li>
<li><p><strong>line_names</strong> (<em>list of strings</em>) – List of the ThorSync line names to be returned.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>lines</strong> – Line arrays in the same order as given in line_names.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils2p</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils2p.synchronization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h5_file</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">find_sync_file</span><span class="p">(</span><span class="s2">&quot;data/mouse_kidney_z_stack&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Frame Counter&quot;</span><span class="p">,</span> <span class="s2">&quot;Capture On&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">frame_counter</span><span class="p">,</span> <span class="n">capture_on</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">synchronization</span><span class="o">.</span><span class="n">get_lines_from_h5_file</span><span class="p">(</span><span class="n">h5_file</span><span class="p">,</span> <span class="n">line_names</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">frame_counter</span><span class="p">)</span>
<span class="go">&lt;class &#39;numpy.ndarray&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">frame_counter</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(54000,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">capture_on</span><span class="p">)</span>
<span class="go">&lt;class &#39;numpy.ndarray&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">capture_on</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(54000,)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils2p.synchronization.process_cam_line">
<span class="sig-prename descclassname"><span class="pre">utils2p.synchronization.</span></span><span class="sig-name descname"><span class="pre">process_cam_line</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seven_camera_metadata</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils2p/synchronization.html#process_cam_line"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils2p.synchronization.process_cam_line" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes superfluous signals and uses frame numbers in array.
The cam line signal form the h5 file is a binary sequence.
Rising edges mark the acquisition of a new frame.
The setup keeps producing rising edges after the acquisition of the
last frame. These rising edges are ignored.
This function converts the binary line to frame numbers using the
information stored in the metadata file of the seven camera setup.
In the metadata file the keys are the indices of the file names
and the values are the grabbed frame numbers. Suppose the 3
frame was dropped. Then the entries in the dictionary will
be as follows:
“2”: 2
“3”: 4
“4”: 5</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>numpy array</em>) – Line signal from h5 file.</p></li>
<li><p><strong>seven_camera_metadata</strong> (<em>string</em>) – Path to the json file saved by our camera software.
This file is usually located in the same folder as the frames
and is called ‘capture_metadata.json’. If None, it is assumed
that no frames were dropped.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>processed_line</strong> – Array with frame number for each time point.
If no frame is available for a given time,
the value is -9223372036854775808.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy array</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils2p</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils2p.synchronization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h5_file</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">find_sync_file</span><span class="p">(</span><span class="s2">&quot;data/mouse_kidney_raw&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">seven_camera_metadata</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">find_seven_camera_metadata_file</span><span class="p">(</span><span class="s2">&quot;data/mouse_kidney_raw&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Basler&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">cam_line</span><span class="p">,)</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">synchronization</span><span class="o">.</span><span class="n">get_lines_from_h5_file</span><span class="p">(</span><span class="n">h5_file</span><span class="p">,</span> <span class="n">line_names</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cam_line</span><span class="p">))</span>
<span class="go">{0, 8, 4294967288}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">processed_cam_line</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">synchronization</span><span class="o">.</span><span class="n">process_cam_line</span><span class="p">(</span><span class="n">cam_line</span><span class="p">,</span> <span class="n">seven_camera_metadata</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">processed_cam_line</span><span class="p">))</span>
<span class="go">{0, 1, -9223372036854775808, 9223372036854775749}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cam_line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">utils2p</span><span class="o">.</span><span class="n">synchronization</span><span class="o">.</span><span class="n">process_cam_line</span><span class="p">(</span><span class="n">cam_line</span><span class="p">,</span> <span class="n">seven_camera_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="go">array([-9223372036854775808,                    0,                    0,</span>
<span class="go">                          0,                    0,                    0,</span>
<span class="go">                          1,                    1,                    1,</span>
<span class="go">                          1,                    1])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils2p.synchronization.process_frame_counter">
<span class="sig-prename descclassname"><span class="pre">utils2p.synchronization.</span></span><span class="sig-name descname"><span class="pre">process_frame_counter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">steps_per_frame</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils2p/synchronization.html#process_frame_counter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils2p.synchronization.process_frame_counter" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts the frame counter line to an array with frame numbers for each
time point.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>numpy array</em>) – Line signal from h5 file.</p></li>
<li><p><strong>metadata</strong> (<a class="reference internal" href="metadata.html#utils2p.Metadata" title="utils2p.Metadata"><code class="xref py py-class docutils literal notranslate"><span class="pre">utils2p.Metadata</span></code></a>) – <a class="reference internal" href="metadata.html#utils2p.Metadata" title="utils2p.Metadata"><code class="xref py py-class docutils literal notranslate"><span class="pre">utils2p.Metadata</span></code></a> object that holding the 2p imaging
metadata for the experiment. Optional. If metadata is not
given steps_per_frame has to be set.</p></li>
<li><p><strong>steps_per_frame</strong> (<em>int</em>) – Number of steps the frame counter takes per frame.
This includes fly back frames and averaging, i.e. if you
acquire one frame and flyback frames is set to 3 this number
should be 4.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>processed_frame_counter</strong> – Array with frame number for each time point.
If no frame was recorded at a time point,
the value is -9223372036854775808.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy array</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils2p</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils2p.synchronization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h5_file</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">find_sync_file</span><span class="p">(</span><span class="s2">&quot;data/mouse_kidney_z_stack&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Frame Counter&quot;</span><span class="p">,]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">frame_counter</span><span class="p">,)</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">synchronization</span><span class="o">.</span><span class="n">get_lines_from_h5_file</span><span class="p">(</span><span class="n">h5_file</span><span class="p">,</span> <span class="n">line_names</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">set</span><span class="p">(</span><span class="n">frame_counter</span><span class="p">)</span>
<span class="go">{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata_file</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">find_metadata_file</span><span class="p">(</span><span class="s2">&quot;data/mouse_kidney_z_stack&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">Metadata</span><span class="p">(</span><span class="n">metadata_file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">processed_frame_counter</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">synchronization</span><span class="o">.</span><span class="n">process_frame_counter</span><span class="p">(</span><span class="n">frame_counter</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">set</span><span class="p">(</span><span class="n">processed_frame_counter</span><span class="p">)</span>
<span class="go">{0, -9223372036854775808}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">steps_per_frame</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get_n_z</span><span class="p">()</span> <span class="o">*</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get_n_averaging</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">steps_per_frame</span>
<span class="go">30</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">processed_frame_counter</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">synchronization</span><span class="o">.</span><span class="n">process_frame_counter</span><span class="p">(</span><span class="n">frame_counter</span><span class="p">,</span> <span class="n">steps_per_frame</span><span class="o">=</span><span class="n">steps_per_frame</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">set</span><span class="p">(</span><span class="n">processed_frame_counter</span><span class="p">)</span>
<span class="go">{0, -9223372036854775808}</span>
</pre></div>
</div>
<p>By default the function treat volumes as frames.
If you want to treat every slice of the volume as a separate frame,
you can do so by <cite>steps_per_frame</cite>. The example has three steps in z.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">steps_per_frame</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get_n_averaging</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">steps_per_frame</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">processed_frame_counter</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">synchronization</span><span class="o">.</span><span class="n">process_frame_counter</span><span class="p">(</span><span class="n">frame_counter</span><span class="p">,</span> <span class="n">steps_per_frame</span><span class="o">=</span><span class="n">steps_per_frame</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">set</span><span class="p">(</span><span class="n">processed_frame_counter</span><span class="p">)</span>
<span class="go">{0, 1, 2, -9223372036854775808}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils2p.synchronization.process_optical_flow_line">
<span class="sig-prename descclassname"><span class="pre">utils2p.synchronization.</span></span><span class="sig-name descname"><span class="pre">process_optical_flow_line</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils2p/synchronization.html#process_optical_flow_line"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils2p.synchronization.process_optical_flow_line" title="Permalink to this definition">¶</a></dt>
<dd><p>This function converts the optical flow line
into a step function. The value corresponds
to the index of optical flow value at this
time point. If the value is -9223372036854775808, no optical flow
value was recorded for this time point.</p>
<p>Note: Due to the time it takes to transfer the data
from the Arduino to the computer it is possible that
the last optical flow data point is missing, i.e.
the processed optical flow line indicates one more
data point than the text file contains. This can be
solved by cropping all lines before the acquisition
of the last optical flow data point. Lines can be
cropped with <a class="reference internal" href="misc_sync.html#utils2p.synchronization.crop_lines" title="utils2p.synchronization.crop_lines"><code class="xref py py-func docutils literal notranslate"><span class="pre">crop_lines()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>line</strong> (<em>numpy array</em>) – Line signal for h5 file.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>processed_optical_flow_line</strong> – Array with monotonically increasing step
function.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy array</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils2p</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils2p.synchronization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h5_file</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">find_sync_file</span><span class="p">(</span><span class="s2">&quot;data/mouse_kidney_raw&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;OpFlow&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">optical_flow_line</span><span class="p">,)</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">synchronization</span><span class="o">.</span><span class="n">get_lines_from_h5_file</span><span class="p">(</span><span class="n">h5_file</span><span class="p">,</span> <span class="n">line_names</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">set</span><span class="p">(</span><span class="n">optical_flow_line</span><span class="p">)</span>
<span class="go">{0, 16}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">processed_optical_flow_line</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">synchronization</span><span class="o">.</span><span class="n">process_optical_flow_line</span><span class="p">(</span><span class="n">optical_flow_line</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">processed_optical_flow_line</span><span class="p">))</span>
<span class="go">1409</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils2p.synchronization.process_stimulus_line">
<span class="sig-prename descclassname"><span class="pre">utils2p.synchronization.</span></span><span class="sig-name descname"><span class="pre">process_stimulus_line</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils2p/synchronization.html#process_stimulus_line"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils2p.synchronization.process_stimulus_line" title="Permalink to this definition">¶</a></dt>
<dd><p>This function converts the stimulus line to an array with
0s and 1s for stimulus off and on respectively. The raw
stimulus line can contain values larger than 1.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>line</strong> (<em>numpy array</em>) – Line signal from h5 file.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>processed_frame_counter</strong> – Array with binary stimulus state for each time point.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy array</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils2p</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils2p.synchronization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h5_file</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">find_sync_file</span><span class="p">(</span><span class="s2">&quot;data/mouse_kidney_raw&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CO2_Stim&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">stimulus_line</span><span class="p">,)</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">synchronization</span><span class="o">.</span><span class="n">get_lines_from_h5_file</span><span class="p">(</span><span class="n">h5_file</span><span class="p">,</span> <span class="n">line_names</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">set</span><span class="p">(</span><span class="n">stimulus_line</span><span class="p">)</span>
<span class="go">{0, 4}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">processed_stimulus_line</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">synchronization</span><span class="o">.</span><span class="n">process_stimulus_line</span><span class="p">(</span><span class="n">stimulus_line</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">set</span><span class="p">(</span><span class="n">processed_stimulus_line</span><span class="p">)</span>
<span class="go">{0, 1}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils2p.synchronization.process_odor_line">
<span class="sig-prename descclassname"><span class="pre">utils2p.synchronization.</span></span><span class="sig-name descname"><span class="pre">process_odor_line</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">30000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arduino_commands</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">('None',</span> <span class="pre">'Odor1',</span> <span class="pre">'Odor2',</span> <span class="pre">'Odor3',</span> <span class="pre">'Odor4',</span> <span class="pre">'Odor5',</span> <span class="pre">'Odor6',</span> <span class="pre">'Odor1R',</span> <span class="pre">'Odor2R',</span> <span class="pre">'Odor1L',</span> <span class="pre">'Odor2L',</span> <span class="pre">'Odor1B',</span> <span class="pre">'Odor2B',</span> <span class="pre">'WaterB',</span> <span class="pre">'bubbleMFC_R0',</span> <span class="pre">'MFC1_R2',</span> <span class="pre">'MFC2_L1')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2703</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils2p/synchronization.html#process_odor_line"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils2p.synchronization.process_odor_line" title="Permalink to this definition">¶</a></dt>
<dd><p>The odor line is based on a PWM signal for the Arduino controlling the
valves. This function applies a Butterworth filter and converts the
resulting voltages to level indices. The corresponding the setting of the
valves are given by the <cite>arduino_commands</cite> argument.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>line</strong> (<em>numpy array</em>) – Unprocessed odor line from h5 file.</p></li>
<li><p><strong>freq</strong> (<em>int</em>) – Frequency of ThorSync. Necessary for the Butterworth filter.</p></li>
<li><p><strong>arduino_commands</strong> (<em>list of strings</em>) – Description of the valve settings for commands sent to arduino.
Note: The order matters since the serial communications between
computer and Arduino is based on the index in the list.
This index is converted to a PWM signal that is recorded by ThorSync.</p></li>
<li><p><strong>step_size</strong> (<em>float</em>) – The voltage step size between different levels of the PWM. This is used
to convert the voltage to indices.</p></li>
<li><p><strong>filter_only</strong> (<em>bool</em>) – If <cite>True</cite>, only the filtered line is returned instead of the odors
based on the <cite>arduino_commands</cite>. This is useful for determining
the <cite>step_size</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy array of strings</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="utils2p.synchronization.get_processed_lines">
<span class="sig-prename descclassname"><span class="pre">utils2p.synchronization.</span></span><span class="sig-name descname"><span class="pre">get_processed_lines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sync_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sync_metadata_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata_2p_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seven_camera_metadata_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils2p/synchronization.html#get_processed_lines"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils2p.synchronization.get_processed_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>This function extracts all the standard lines and processes them.
It works for both microscopes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sync_file</strong> (<em>str</em>) – Path to the synchronization file.</p></li>
<li><p><strong>sync_metadata_file</strong> (<em>str</em>) – Path to the synchronization metadata file.</p></li>
<li><p><strong>metadata_2p_file</strong> (<em>str</em>) – Path to the ThorImage metadata file.</p></li>
<li><p><strong>seven_camera_metadata_file</strong> (<em>str</em>) – Path to the metadata file of the 7 camera system.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>processed_lines</strong> – Dictionary with all processed lines.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dictionary</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils2p</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils2p.synchronization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">experiment_dir</span> <span class="o">=</span> <span class="s2">&quot;data/mouse_kidney_raw/&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sync_file</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">find_sync_file</span><span class="p">(</span><span class="n">experiment_dir</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata_file</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">find_metadata_file</span><span class="p">(</span><span class="n">experiment_dir</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sync_metadata_file</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">find_sync_metadata_file</span><span class="p">(</span><span class="n">experiment_dir</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">seven_camera_metadata_file</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">find_seven_camera_metadata_file</span><span class="p">(</span><span class="n">experiment_dir</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">processed_lines</span> <span class="o">=</span> <span class="n">utils2p</span><span class="o">.</span><span class="n">synchronization</span><span class="o">.</span><span class="n">get_processed_lines</span><span class="p">(</span><span class="n">sync_file</span><span class="p">,</span> <span class="n">sync_metadata_file</span><span class="p">,</span> <span class="n">metadata_file</span><span class="p">,</span> <span class="n">seven_camera_metadata_file</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">utils2p</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="main.html">Core functions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="synchronization.html">Synchronization functions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="synchronization.html#synchronization-module">Synchronization module</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Loading and preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="conversion.html">Conversion of synchronization</a></li>
<li class="toctree-l2"><a class="reference internal" href="misc_sync.html">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="synchronization.html">Synchronization functions</a><ul>
      <li>Previous: <a href="synchronization.html" title="previous chapter">Synchronization functions</a></li>
      <li>Next: <a href="conversion.html" title="next chapter">Conversion of synchronization</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Florian Aymanns.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/loading_preprocessing.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>